AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31
Description: >
  slack-todo-app

Resources:
  Challenge:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: challenge
      CodeUri: challenge/
      Handler: index.handler
      Runtime: nodejs16.x
      Role: arn:aws:iam::907081723216:role/SamDeployRole
      Architectures:
        - arm64
      Environment:
        Variables:
          TZ: Asia/Tokyo
      Events:
        ChallengeApi:
          Type: Api
          Properties:
            Path: /challenge
            Method: post
            RestApiId: !Ref SlackTodoApi
    Metadata:
      BuildMethod: esbuild
      BuildProperties:
        Minify: true
        Target: "es2020"
        Sourcemap: true
        # Format: "esm"
        OutExtensions:
          - .js=.mjs
        EntryPoints:
          - index.mts

  SlackTodoApi:
    Type: AWS::Serverless::Api
    Properties:
      Name: slack-todo-api
      EndpointConfiguration:
        Type: REGIONAL
      StageName: prod

  # SlackTodoLogs:
  #   Type: 'AWS::Logs::LogGroup'
  #   Properties:
  #     LogGroupName: !Sub '/aws/lambda/${Challenge}'
  #     RetentionInDays: 1

